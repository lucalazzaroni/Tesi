\chapter{Modello del motore}
\section{Dalla potenza alla velocità angolare}

\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{motoreSimulink.jpg}
	\caption{Schema a blocchi Motore}
	\label{motoreSimulink}
\end{figure}
Il LEGO MINDSTORM EV3 è dotato di un motore, l'EV3 Large Servo Motor, la cui velocità angolare, misurata in $rad/s$, è stata assunta come uscita del sistema.\\
I valori di ingresso possibili sono invece compresi tra -100 e +100, dove +100 indica la massima potenza erogabile, mentre -100 idem, ma con verso di rotazione opposto.\\
Al fine di modellare nel modo più preciso possibile abbiamo applicato a tale motore un albero dotato di pesi posti a una certa distanza da quest'ultimo in modo tale da incrementare il momento d'inerzia $I$ e, di conseguenza, diminuire l'accelerazione angolare massima $\alpha$ in accordo con la seconda legge di Newton (in forma angolare) $\tau = I\alpha$, dove $\tau$ è il momento della forza o, più semplicemente, la coppia massima erogata: valore caratteristico del motore.
\newpage
\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{megainerzia.png}
	\caption{Albero per aumentare Inerzia del motore}
	\label{megainerzia}
\end{figure}
In questo modo il tempo di assestamento $t_a$ del sistema, direttamente proporzionale a $\alpha$, è sensibilmente più lungo ed è dunque più semplice trovare una funzione di trasferimento assimilabile a quella dell'EV3 Large Servo Motor.\\
All'interno del motore è inoltre presente un'encoder che permette di misurare, in gradi, la posizione angolare dello stesso.
Di conseguenza, al fine di ottenere la velocità angolare $\omega$ è stato applicato in cascata un derivatore, ma anche un filtro passa basso con frequenza di taglio $\omega_c=25\;Hz$, necessario per attenuare le alte frequenze del sistema, al fine di ottenere una funzione in uscita meno spezzata possibile e, di conseguenza, più facilmente identificabile.\\
Al fine di ridurre il più possibile l'errore è stato scelto come tempo di campionamento dell'encoder il valore minimo supportato: 0.001 $s$.\\
Il risultato che si ottiene utilizzando come ingresso una funzione gradino con valore finale pari a 50 è mostrato nella figura \ref{motore50StepCamp1000}.
\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{motore50StepCamp1000.jpg}
	\caption{Risposta al gradino con $\omega_c=25\;Hz$}
	\label{motore50StepCamp1000}
\end{figure}
\\Scegliendo invece una frequenza di taglio del filtro passa basso $\omega_c = 100Hz$ l'uscita del sistema diventa:
\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{motore50StepCamp1000Polo100.jpg}
	\caption{Risposta al gradino con $\omega_c=100\;Hz$ }
	\label{motore50StepCamp1000Polo100}
\end{figure}
\\Si può notare come la frequenza di taglio sia troppo elevata non attenuando abbastanza le alte frequenze e rendendo così impossibile una stima della funzione di trasferimento.\\
Prendendo quindi in esame il primo dei due grafici si può stimare una costante di tempo $\tau$ (tempo che impiega la funzione a raggiungere il 63\% del valore di regime) del sistema pari a circa 0.15 $s$ e guadagno statico 10.4.\\\\
La funzione di trasferimento che ne consegue è dunque:
\\
$$
T_{motore}(s)=\displaystyle\frac{10.4}{0.15s+1}
$$
\\
Di seguito un confronto tra $T_{motore}(s)$ e la funzione di trasferimento reale del motore.
\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{modMotorvsReale.jpg}
	\caption{Risposta al gradino del Motore reale e del suo modello}
	\label{modMotorvsReale}
\end{figure}

\section{Dalla velocità angolare alla coppia}
È necessario ora ottenere la coppia generata dal motore in funzione del tempo al fine di utilizzarla come ingresso per la funzione di trasferimento del pendolo che sarà trattata in modo approfondito nel prossimo capitolo.\\
La formula utilizzata per calcolare tale coppia è la seguente:
$$
\tau=K\omega+I\alpha
$$
Dove il primo termine dell'equazione indica appunto la coppia, mentre i restanti due sono rispettivamente lo smorzamento viscoso e il momento torcente.
Più nello specifico $K$ rappresenta il coefficiente di smorzamento viscoso misurato in $Nm\,s/rad$, $\omega$ la velocità angolare, $I$ il momento d'inerzia del sistema e $\alpha$ l'accelerazione angolare.\\
Calcoliamo innanzi tutto $I$: 
$$
I=3M_Rd_R^2+3M_rd_r^2+3I_a+3I_A+\displaystyle\frac{m_ar^2}{2}
$$
Il primi due termini indicano i momenti d'inerzia delle sei ruote (assunte come masse uniformi per semplicità), il terzo e il quarto quelli delle sei aste che collegano le ruote all'albero, mentre l'ultimo termine rappresenta il momento d'inerzia dell'albero (asta centrale).\\
Per calcolare $I$ delle sei aste utilizziamo il teorema di Huygens-Steiner, o degli assi paralleli:
$$
I=I_{cdm}+m_{asta}d^2
$$
Dove $d$ è la distanza tra l'asse passante per il centro di massa e quello parallelo di rotazione (rispetto al quale calcoliamo il momento).\\
$$
I_{asta}=\displaystyle\frac{1}{12}m_{asta}l^2+m_{asta}(\displaystyle\frac{l}{2})^2=\displaystyle\frac{1}{3}m_{asta}l^2
$$
Inserendo ora i parametri calcolati sperimentalmente e riportati nella tabella sottostante, si ricava un momento d'inerzia $I$ pari a 0.001364 $Kg\,m^2$.\\\\
\begin{tabular}{|l|l|l|l|}
	\hline
	\textbf{Sigla} & \textbf{Valore} & \textbf{U.d.m.} & \textbf{Parametro}\\
	\hline
	$M_R$ & 0.0395 & $kg$ & massa ruota grande\\
	\hline
	$M_r$ & 0.023 & $kg$ & massa ruota piccola\\
	\hline
	$m_a$ & 0.0015 & $kg$ & massa asta corta\\	
	\hline
	$m_A$ & 0.002 & $kg$ & massa asta lunga\\	
	\hline
	$l_a$ & 0.068 & $m$ & lunghezza asta corta\\
	\hline
	$r$ & 0.002 & $m$ & raggio asta\\
	\hline
	$l_A$ & 0.091 & $m$ & lunghezza asta lunga\\
	\hline
	$d_r$ & 0.061 & $m$ & distanza ruota piccola - asse di rotazione\\
	\hline
	$d_R$ & 0.085 & $m$  & distanza ruota grande - asse di rotazione\\
	\hline
\end{tabular}\\\\\\
Essendo $\tau=K\omega+I\alpha$ possiamo disegnare tramite Simulink il diagramma a blocchi rappresentato in figura \ref{modMotoreTorque}:
\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{modMotoreTorque.jpg}
	\caption{Modello completo del Motore}
	\label{modMotoreTorque}
\end{figure}
\\L'uscita del sistema è proprio la coppia $\tau$ desiderata.\\
Si può notare come nel blocco inferiore siano stati aggiunti il derivatore e il filtro passa basso.\\
Il primo è necessario dal momento che l'accelerazione angolare $\alpha$ è proprio la derivata della velocità angolare $\omega$.\\
Per quanto riguarda il filtro, invece, è stato aggiunto (scegliendo appositamente una frequenza di taglio abbastanza alta da non alterare la dinamica del sistema) siccome un derivatore puro è fisicamente irrealizzabile (funzione impropria).\\
Inoltre si è resa necessaria anche l'aggiunta di un blocco di saturazione dell'ingresso dal momento che, come già reso noto in precedenza, l'EV3 Large Servo Motor accetta valori compresi tra -100 e +100.\\
In ultimo il valore di K è stato invece ricavato sperimentalmente avendo nota la coppia a regime, caratteristica dell'EV3 Large Servo Motor e pari a 0.2 $Nm$.\\
Come si mostrato in figura \ref{torque02} un valore di K pari a 0.000192 $Nm\,s/rad$ consente di rispettare appieno tale specifica.
\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{torque02.jpg}
	\caption{Risposta al gradino del modello completo}
	\label{torque02}
\end{figure}